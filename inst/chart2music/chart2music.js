/**
 * Minified by jsDelivr using Terser v5.14.1.
 * Original file: /npm/chart2music@1.3.0/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var c2mChart=function(){"use strict";class t{constructor(t){this._audioContext=t,this._masterCompressor=t.createDynamicsCompressor(),this._masterCompressor.connect(this._audioContext.destination),this._masterCompressor.threshold.value=-50,this._masterCompressor.knee.value=40,this._masterCompressor.ratio.value=12,this._masterCompressor.attack.value=0,this._masterCompressor.release.value=.25,this._masterGain=this._audioContext.createGain(),this._masterGain.gain.value=.5,this._masterCompressor.connect(this._masterGain),this._masterGain.connect(this._audioContext.destination)}get masterGain(){return this._masterGain.gain.value}set masterGain(t){this._masterGain.gain.value=t}playDataPoint(t,e,i=.2){const a=this._audioContext.currentTime,n=this._audioContext.createOscillator();n.frequency.value=t,n.start();const{carrier:s,amp:r,modulator:o,filter:l,adsr:h}=function(t,e,i,a){const n=t.createOscillator(),s=t.createGain(),r=t.createOscillator(),o=t.createBiquadFilter(),l=t.createGain();return n.frequency.value=e,r.frequency.value=i,s.gain.value=a,r.connect(s),s.connect(n.frequency),n.connect(o),o.connect(l),n.start(),r.start(),{carrier:n,amp:s,modulator:r,filter:o,adsr:l}}(this._audioContext,.5*t,3*t,2*t);s.type="triangle",h.gain.setValueCurveAtTime([.2,.1],a,.75*i),l.frequency.value=t,l.type="lowpass";const _=this._audioContext.createGain();_.gain.setValueCurveAtTime([.5,1,.5,.5,.5,.1,1e-4],a,i);const u=this._audioContext.createStereoPanner();u.pan.value=e,n.connect(_),h.connect(_),_.connect(u),u.connect(this._masterCompressor),setTimeout((()=>{u.disconnect(),_.disconnect(),h.disconnect(),n.stop(),n.disconnect(),o.stop(),o.disconnect(),s.stop(),s.disconnect(),r.disconnect(),l.disconnect()}),1e3*i*2)}}const e=[16.3516,17.32391,18.35405,19.44544,20.60172,21.82676,23.12465,24.49971,25.95654,27.5,29.13524,30.86771,32.7032,34.64783,36.7081,38.89087,41.20344,43.65353,46.2493,48.99943,51.91309,55,58.27047,61.73541,65.40639,69.29566,73.41619,77.78175,82.40689,87.30706,92.49861,97.99886,103.8262,110,116.5409,123.4708,130.8128,138.5913,146.8324,155.5635,164.8138,174.6141,184.9972,195.9977,207.6523,220,233.0819,246.9417,261.6256,277.1826,293.6648,311.127,329.6276,349.2282,369.9944,391.9954,415.3047,440,466.1638,493.8833,523.2511,554.3653,587.3295,622.254,659.2551,698.4565,739.9888,783.9909,830.6094,880,932.3275,987.7666,1046.502,1108.731,1174.659,1244.508,1318.51,1396.913,1479.978,1567.982,1661.219,1760,1864.655,1975.533,2093.005,2217.461,2349.318,2489.016,2637.02,2793.826,2959.955,3135.963,3322.438,3520,3729.31,3951.066,4186.009,4434.922,4698.636,4978.032,5274.041,5587.652,5919.911,6271.927,6644.875,7040,7458.62,7902.133],i=[1e3,250,100,50,25],a=.25,n=t=>`${t.altKey?"Alt+":""}${t.ctrlKey?"Ctrl+":""}${t.shiftKey?"Shift+":""}${t.key}`;class s{constructor(t){this._keyMap={},this._target=t,this._target.addEventListener("keydown",(t=>{this._handleKeyEvents(t)})),this._target.hasAttribute("tabIndex")||this._target.setAttribute("tabIndex","0")}_handleKeyEvents(t){const e=n(t);e in this._keyMap&&(this._keyMap[e].callback(),t.preventDefault())}registerKeyEvent({key:t,callback:e,title:i="",description:a="",force:n=!1,keyDescription:s}){!n&&t in this._keyMap||(this._keyMap[t]={title:i,description:a,callback:e,keyDescription:s})}registerKeyEvents(t){t.forEach((t=>{this.registerKeyEvent(t)}))}generateHelpDialog(){const t=document.createElement("div");t.setAttribute("role","dialog");const e=document.createElement("h1");e.textContent="Keyboard Manager",t.appendChild(e);const i=document.createElement("table"),a=document.createElement("tbody");return Object.entries(this._keyMap).forEach((([t,e])=>{const i=document.createElement("tr"),n=document.createElement("th");n.scope="row",n.textContent=e.title,i.appendChild(n);const s=document.createElement("td");s.textContent=e.keyDescription??t,i.appendChild(s);const r=document.createElement("td");r.textContent=e.description,i.appendChild(r),a.appendChild(i)})),i.appendChild(a),t.appendChild(i),t}launchHelpDialog(){this._preLaunchActiveElement=document.activeElement;const t=this.generateHelpDialog();document.body.appendChild(t);new s(t).registerKeyEvent({key:"Escape",callback:()=>{this._preLaunchActiveElement?.focus()}}),t.focus();t.addEventListener("blur",(()=>{t.parentNode.removeChild(t)}))}}class r{constructor(t){this._maxNumPaddingCharacters=3,this._numPaddingCharacters=0,this._element=t,this._lastCreatedElement=null}static addAriaAttributes(t,e="assertive"){t.setAttribute("aria-live",e),t.setAttribute("roll","status"),t.setAttribute("aria-atomic","true"),t.setAttribute("aria-relevant","additions text")}get lastCreatedElement(){return this._lastCreatedElement}clear(){this._element.innerHTML=""}render(t){const e=this._creatPaddedText(t),i=document.createElement("div");i.textContent=e,i.setAttribute(r.ORIGINAL_TEXT_ATTRIBUTE,t),i.setAttribute("data-created",Date.now().toString()),this.lastCreatedElement&&(this._removeOldElements(),this.lastCreatedElement.style.display="none"),this._element.appendChild(i),this._lastCreatedElement=i}_creatPaddedText(t){let e="";for(let t=0;t<this._numPaddingCharacters;t++)e+=r.PADDING_CHARACTER;return this._numPaddingCharacters=(this._numPaddingCharacters+1)%this._maxNumPaddingCharacters,t+e}_removeOldElements(){const t=Date.now();Array.from(this._element.children).forEach((e=>{const i=Number(e.getAttribute("data-time"));t-i>r.REMOVAL_DELAY&&this._element.removeChild(e)}))}}function o(t){return"object"==typeof t&&"x"in t}function l(t){return o(t)&&"y"in t}function h(t){return o(t)&&"y2"in t}function _(t){return o(t)&&"high"in t&&"low"in t}function u(t){return _(t)&&"open"in t&&"close"in t}r.PADDING_CHARACTER="Â ",r.REMOVAL_DELAY=25,r.ORIGINAL_TEXT_ATTRIBUTE="data-original-text";const p=(t,e,i,a,n)=>"linear"===n?m(t,e,i,a):d(t,e,i,a),m=(t,e,i,a)=>{const n=(t-e)/(i-e);return Math.floor(a*n)},d=(t,e,i,a)=>{const n=Math.log10(t),s=Math.log10(e),r=(n-s)/(Math.log10(i)-s);return Math.floor(a*r)},c=(t,e)=>{const i=t.flat().map((t=>{if(l(t)){if("x"===e||"y"===e)return t[e]}else if(h(t)){if("x"===e||"y2"===e)return t[e]}else if(u(t)){if("x"===e)return t.x;if("y"===e)return Math.min(t.high,t.low,t.open,t.close)}else if(_(t)){if("x"===e)return t.x;if("y"===e)return Math.min(t.high,t.low)}return NaN})).filter((t=>!isNaN(t)));return 0===i.length?NaN:Math.min(...i)},y=(t,e)=>{const i=t.flat().map((t=>{if(l(t)){if("x"===e||"y"===e)return t[e]}else if(h(t)){if("x"===e||"y2"===e)return t[e]}else if(u(t)){if("x"===e)return t.x;if("y"===e)return Math.max(t.high,t.low,t.open,t.close)}else if(_(t)){if("x"===e)return t.x;if("y"===e)return Math.max(t.high,t.low)}return NaN})).filter((t=>!isNaN(t)));return 0===i.length?NaN:Math.max(...i)},x=t=>`${t}`,g=(t,e,i)=>({minimum:i?.minimum??c(t,e),maximum:i?.maximum??y(t,e),label:i?.label??"",format:i?.format??x,type:i?.type??"linear"}),v=t=>"number"==typeof t?"number":"object"!=typeof t?"unknown":l(t)?"SimpleDataPoint":h(t)?"AlternativeAxisDataPoint":u(t)?"OHLCDataPoint":_(t)?"HighLowDataPoint":"unknown",f=t=>t.map(((t,e)=>"number"==typeof t?{x:e,y:t}:t)),A=t=>e=>isNaN(e)?"missing":t.minimum&&e<t.minimum?"too low":t.maximum&&e>t.maximum?"too high":t.format(e),b=(t,e)=>isNaN(t)||t<e.minimum||t>e.maximum,I=()=>[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((t=>navigator.userAgent.match(t)));var E;!function(t){t.LINE="line",t.BAR="bar",t.BAND="band",t.PIE="pie",t.CANDLESTICK="candlestick"}(E||(E={}));const k=t=>{if(void 0===t)return`Required parameter 'type' was left undefined. Supported types are: ${Object.values(E).join(", ")}`;if(Array.isArray(t)){const e=t.filter((t=>!Object.values(E).includes(t)));return 0===e.length?"":`Invalid input types: ${e.join(", ")}. Valid types are: ${Object.values(E).join(", ")}`}return Object.values(E).includes(t)?"":`Invalid input type: ${t}. Valid types are: ${Object.values(E).join(", ")}`},w=t=>void 0===t?"Required parameter 'element' was left undefined. An HTMLElement must be provided for this parameter.":t instanceof HTMLElement?"":"Provided value for 'element' must be an instance of HTMLElement.",C=["linear","log10"],S=t=>{if(void 0===t)return"";const e=["x","y","y2"],i=Object.keys(t).filter((t=>!e.includes(t)));if(i.length>0)return`Unsupported axes were included: ${i.join(", ")}. The only supported axes are: ${e.join(", ")}.`;for(const e in t){const i=t[e];if("string"==typeof i.type&&!C.includes(i.type))return`Axis ${e} has an unsupported axis type "${i.type}". Valid axis types are: ${C.join(", ")}.`;if("log10"===i.type&&(0===i.minimum||0===i.maximum))return`Axis ${e} has type "log10", but has a minimum or maximum value of 0. No values <= 0 are supported for logarithmic axes.`}return""},T=t=>{if(Array.isArray(t))return L(t);for(const e in t){const i=L(t[e]);if(""!==i)return`Error for data category ${e}: ${i}`}return""},L=t=>{const e=t[0];if("number"==typeof e){const e=t.findIndex((t=>!("number"==typeof t)));return-1===e?"":`The first item is a number, but item index ${e} is not (value: ${JSON.stringify(t[e])}). All items should be of the same type.`}if(l(e)){const e=t.findIndex((t=>!l(t)));return-1===e?"":`The first item is a simple data point (x/y), but item index ${e} is not (value: ${JSON.stringify(t[e])}). All items should be of the same type.`}if(h(e)){const e=t.findIndex((t=>!h(t)));return-1===e?"":`The first item is an alternate axis data point (x/y2), but item index ${e} is not (value: ${JSON.stringify(t[e])}). All items should be of the same type.`}if(u(e)){const e=t.findIndex((t=>!u(t)));return-1===e?"":`The first item is an OHLC data point (x/open/high/low/close), but item index ${e} is not (value: ${JSON.stringify(t[e])}). All items should be of the same type.`}if(_(e)){const e=t.findIndex((t=>!_(t)));return-1===e?"":`The first item is a high low data point (x/high/low), but item index ${e} is not (value: ${JSON.stringify(t[e])}). All items should be of the same type.`}return`The first item is of an unrecognized type (value: ${JSON.stringify(e)}). Supported types are: number, simple data point (x/y), alternative axis data point (x/y2), and high low data point (x/high/low).`};var $,N;!function(t){t.NEXT_POINT="next_point",t.PREVIOUS_POINT="previous_point",t.PLAY_RIGHT="play_right",t.PLAY_LEFT="play_left",t.STOP_PLAY="stop_play",t.PREVIOUS_STAT="previous_stat",t.NEXT_STAT="next_stat",t.PREVIOUS_CATEGORY="previous_category",t.NEXT_CATEGORY="next_category",t.FIRST_POINT="first_point",t.LAST_POINT="last_point",t.REPLAY="replay",t.SELECT="select",t.PREVIOUS_TENTH="previous_tenth",t.NEXT_TENTH="next_tenth",t.GO_MINIMUM="go_minimum",t.GO_MAXIMUM="go_maximum",t.SPEED_UP="speed_up",t.SLOW_DOWN="slow_down",t.MONITOR="monitor",t.HELP="help",t.OPTIONS="options"}($||($={})),function(t){t.LEFT="left",t.RIGHT="right",t.UP="up",t.DOWN="down",t.DOUBLE_LEFT="double_left",t.DOUBLE_RIGHT="double_right",t.DOUBLE_UP="double_up",t.DOUBLE_DOWN="double_down"}(N||(N={}));let M=null;class O{constructor(t){var i,a;this._groupIndex=0,this._pointIndex=0,this._playListInterval=null,this._speedRateIndex=1,this._flagNewGroup=!1,this._flagNewStat=!1,this._audioEngine=null,this._options={enableSound:!0,enableSpeech:!0,live:!1},this._monitorMode=!1,this._explicitAxes={},this._hertzClamps={upper:e.length-12,lower:21},this._type=t.type,this._providedAudioEngine=t.audioEngine,this._title=t.title??"",this._chartElement=t.element,i=this._chartElement,a=this._title,i.hasAttribute("alt")||i.hasAttribute("aria-label")||i.setAttribute("aria-label",`${a}, Sonified chart`),i.hasAttribute("role")||i.setAttribute("role","img"),this._ccElement=t.cc??this._chartElement,this._setData(t.data,t.axes),t?.options&&(this._options={...this._options,...t?.options}),this._generateSummary(),r.addAriaAttributes(this._ccElement),this._sr=new r(this._ccElement),this._availableActions=this._initializeActionMap(),this._initializeKeyActionMap(),this._initializeTouchActions(),this._startListening()}_initializeActionMap(){return{next_point:()=>{clearInterval(this._playListInterval),this._moveRight()&&this._playAndSpeak()},previous_point:()=>{clearInterval(this._playListInterval),this._moveLeft()&&this._playAndSpeak()},play_right:()=>{clearInterval(this._playListInterval),this._playRight()},play_left:()=>{clearInterval(this._playListInterval),this._playLeft()},stop_play:()=>{clearInterval(this._playListInterval)},previous_stat:()=>{clearInterval(this._playListInterval),this._movePrevStat()&&(this._flagNewStat=!0,this._playAndSpeak())},next_stat:()=>{clearInterval(this._playListInterval),this._moveNextStat()&&(this._flagNewStat=!0,this._playAndSpeak())},previous_category:()=>{clearInterval(this._playListInterval),0!==this._groupIndex&&(this._groupIndex--,this._flagNewGroup=!0,this._playAndSpeak())},next_category:()=>{clearInterval(this._playListInterval),this._groupIndex!==this._data.length-1&&(this._groupIndex++,this._flagNewGroup=!0,this._playAndSpeak())},first_point:()=>{clearInterval(this._playListInterval),this._pointIndex=0,this._playAndSpeak()},last_point:()=>{clearInterval(this._playListInterval),this._pointIndex=this._data[this._groupIndex].length-1,this._playAndSpeak()},replay:()=>{clearInterval(this._playListInterval),this._flagNewGroup=!0,this._flagNewStat=!0,this._playAndSpeak()},select:()=>{this._options.onSelectCallback?.({slice:this._groups[this._groupIndex],index:this._pointIndex})},previous_tenth:()=>{clearInterval(this._playListInterval),this._moveLeftTenths(),this._playAndSpeak()},next_tenth:()=>{clearInterval(this._playListInterval),this._moveRightTenths(),this._playAndSpeak()},go_minimum:()=>{clearInterval(this._playListInterval),this._moveToMinimum()&&this._playAndSpeak()},go_maximum:()=>{clearInterval(this._playListInterval),this._moveToMaximum()&&this._playAndSpeak()},speed_up:()=>{clearInterval(this._playListInterval),this._speedRateIndex<i.length-1&&this._speedRateIndex++,this._sr.render(`Speed, ${i[this._speedRateIndex]}`)},slow_down:()=>{clearInterval(this._playListInterval),this._speedRateIndex>0&&this._speedRateIndex--,this._sr.render(`Speed, ${i[this._speedRateIndex]}`)},monitor:()=>{this._options.live?(this._monitorMode=!this._monitorMode,this._sr.render("Monitoring "+(this._monitorMode?"on":"off"))):this._sr.render("Not a live chart")},help:()=>{clearInterval(this._playListInterval),this._keyEventManager.launchHelpDialog()},options:()=>{this._checkAudioEngine(),(({upper:t,lower:i},a,n)=>{const s=document.activeElement,r=document.createElement("div");r.setAttribute("role","dialog"),r.innerHTML=`<h1>Options</h1>\n\n    <p tabIndex="0">While navigating this chart, you may find some sounds too low or too high to hear. Alternatively, you may want to expand the range of the sounds available. Use these sliders to adjust the range of sound:</p>\n\n    <form id="optionForm">\n        <div>\n            <label>\n                Lower hertz:\n                <input type="range" min="0" max="${t-1}" step="1" id="lowerRange" value="${i}" />\n            </label>\n        </div>\n        <div>\n            <label>\n                Upper hertz:\n                <input type="range" min="${i+1}" max="${e.length-1}" step="1" id="upperRange" value="${t}" />\n            </label>\n        </div>\n\n        <div>\n            <label>\n                <input type="checkbox" id="global" checked />\n                Save my options for other charts on this page\n            </label>\n        </div>\n\n        <input id="save" type="submit" value="Save" />\n    </form>\n    `;const o=r.querySelector("#lowerRange"),l=r.querySelector("#upperRange"),h=r.querySelector("#global");window||(h.parentElement.parentElement.style.display=" none");const _=()=>{const t=Number(o.value),e=Number(l.value),i=h.checked;a(t,e),window&&i&&(window.__chart2music_options__||(window.__chart2music_options__={}),window.__chart2music_options__={_hertzClamps:{lower:t,upper:e}}),u()};r.querySelector("#optionForm").addEventListener("submit",(t=>{t.preventDefault(),_()})),r.querySelector("#save").addEventListener("click",(t=>{t.preventDefault(),_()})),n&&(o.addEventListener("change",(()=>{n(Number(o.value)),l.min=String(Number(o.value)+1)})),l.addEventListener("change",(()=>{n(Number(l.value)),o.max=String(Number(l.value)-1)})));const u=()=>{s.focus(),r.parentElement.removeChild(r)};r.addEventListener("keydown",(t=>{"Escape"===t.key&&u()})),r.addEventListener("blur",u),document.body.appendChild(r),r.querySelector("[tabIndex]").focus()})(this._hertzClamps,((t,e)=>{this._setHertzClamps(t,e)}),(t=>{this._audioEngine?.playDataPoint(e[t],0,a)}))}}}_initializeTouchActions(){let t=[];const e=this._chartElement,i={left:this._availableActions.previous_point,right:this._availableActions.next_point,up:this._availableActions.previous_stat,down:this._availableActions.next_stat,double_down:this._availableActions.next_category,double_left:this._availableActions.play_left,double_right:this._availableActions.play_right,double_up:this._availableActions.previous_category};let a=0,n="",s=null;e.addEventListener("touchstart",(e=>{e.preventDefault(),this._availableActions.stop_play(),document.activeElement!==this._chartElement&&this._chartElement.focus(),Array.from(e.targetTouches).forEach((e=>{t.push(e)}))}));const r=e=>{e.preventDefault();let r="";Array.from(e.changedTouches).forEach((e=>{const o=t.find((t=>t.identifier===e.identifier));t=t.filter((t=>t.identifier!==e.identifier));const{clientX:l,clientY:h}=o,{clientX:_,clientY:u}=e,p=_-l,m=u-h;if(p<-200&&Math.abs(m)<200)r=N.LEFT;else if(p>200&&Math.abs(m)<200)r=N.RIGHT;else if(m<-200&&Math.abs(p)<200)r=N.UP;else{if(!(m>200&&Math.abs(p)<200))return void(r="");r=N.DOWN}a>(new Date).valueOf()-25&&r===n&&(clearTimeout(s),i[`double_${r}`](),r=""),t.length>0&&(a=(new Date).valueOf(),n=r),s=setTimeout((()=>{i[r]?.(),r=""}),25)}))};e.addEventListener("touchend",r),e.addEventListener("touchcancel",r)}_generateSummary(){this._summary=(({type:t,title:e,dataRows:i,x:a,y:n,y2:s,live:r=!1})=>{const o=[];Array.isArray(t)?o.push(`Sonified ${r?"live ":""}${t.sort().join("-")} chart "${e}"`):o.push(`Sonified ${r?"live ":""}${t} chart "${e}"`),i>1&&o.push(`contains ${i} categories`),o.push(`x is "${a.label}" from ${a.format(a.minimum)} to ${a.format(a.maximum)}`),o.push(`y is "${n.label}" from ${n.format(n.minimum)} to ${n.format(n.maximum)}`),s&&o.push(`alternative y is "${s.label}" from ${s.format(s.minimum)} to ${s.format(s.maximum)}`);const l=I(),h=`Use arrow keys to navigate.${r?" Press M to toggle monitor mode.":""} Press H for more hotkeys.`;return`${o.join(", ")}. ${l?"Swipe left or right to navigate. 2 finger swipe left or right to play the rest of the category.":h}`})({type:this._type,title:this._title,x:this._xAxis,y:this._yAxis,dataRows:this._groups.length,y2:this._y2Axis,live:this._options.live})}_setData(t,e){this._explicitAxes={x:{...this._explicitAxes.x??{},...e?.x??{}},y:{...this._explicitAxes.y??{},...e?.y??{}},y2:{...this._explicitAxes.y2??{},...e?.y2??{}}},this._initializeData(t),this._metadataByGroup=(t=>t.map((t=>{let e=[],i=[];l(t[0])?e=t.map((({y:t})=>t)):h(t[0])?e=t.map((({y2:t})=>t)):u(t[0])?i=["open","high","low","close"]:_(t[0])&&(i=["high","low"]);const a=Math.min(...e),n=Math.max(...e),s=Math.round(t.length/10);return{minimumPointIndex:e.indexOf(a),maximumPointIndex:e.indexOf(n),tenths:s,availableStats:i,statIndex:-1,inputType:v(t[0])}})))(this._data),this._metadataByGroup=((t,e)=>{if(Array.isArray(e)&&"number"==typeof e[0])t[0].inputType="number";else{let i=0;for(const a in e)"number"===v(e[a][0])&&(t[i].inputType="number"),i++}return t})(this._metadataByGroup,t),this._xAxis=g(this._data,"x",this._explicitAxes.x),this._yAxis=g(this._data,"y",this._explicitAxes.y),((t,e)=>void 0!==t.find((t=>t.find((t=>e in t)))))(this._data,"y2")&&(this._y2Axis=g(this._data,"y2",this._explicitAxes.y2)),this._generateSummary()}setData(t,e,i,a){this._setData(t,e),this._pointIndex=Math.min(Math.max(i??0,0),this._data[0].length-1),this._groupIndex=Math.max(this._groups.indexOf(a),0),this._sr.render(`${this._title||"Chart"} updated`)}getCurrent(){const{statIndex:t,availableStats:e}=this._metadataByGroup[this._groupIndex];return{group:this._groups[this._groupIndex],point:this._data[this._groupIndex][this._pointIndex],stat:e[t]??""}}_shrinkToMaxWidth(){if(void 0===this._options.maxWidth)return;let t=!1,e=!1,i=!1;for(let a=0;a<this._data.length;a++){if(this._data[a].length<=this._options.maxWidth)continue;const n=this._data[a].shift();this._pointIndex--,this._xAxis.minimum!==n.x&&this._xAxis.maximum!==n.x||(t=!0),e=!0,h(n)&&(i=!0);"number"===this._metadataByGroup[a].inputType&&this._data[a].forEach(((t,e)=>{this._data[a][e].x=e}))}t&&(this._xAxis.minimum=c(this._data,"x"),this._xAxis.maximum=y(this._data,"x")),e&&(this._yAxis.minimum=c(this._data,"y"),this._yAxis.maximum=y(this._data,"y")),i&&(this._y2Axis.minimum=c(this._data,"y2"),this._y2Axis.maximum=y(this._data,"y2")),this._pointIndex<0&&(this._pointIndex=0)}appendData(t,e){const i=e?this._groups.indexOf(e):0;if(-1===i)return{err:`Error adding data to unknown group name "${e}". ${1===this._groups.length?"There are no group names.":`Valid groups: ${this._groups.join(", ")}`} `};const a=v(t),n=this._metadataByGroup[i].inputType;if(a!==n)return{err:`Mismatched type error. Trying to add data of type ${a} to target data of type ${n}.`};const s="number"==typeof t?{x:this._data[i].length,y:t}:t;if(this._data[i].push(s),this._xAxis.maximum=Math.max(this._xAxis.maximum,s.x),l(s)?(this._yAxis.maximum=Math.max(this._yAxis.maximum,s.y),this._yAxis.minimum=Math.min(this._yAxis.minimum,s.y)):u(s)?(this._yAxis.maximum=Math.max(this._yAxis.maximum,s.open,s.high,s.low,s.close),this._yAxis.minimum=Math.min(this._yAxis.minimum,s.open,s.high,s.low,s.close)):_(s)&&(this._yAxis.maximum=Math.max(this._yAxis.maximum,s.high,s.low),this._yAxis.minimum=Math.min(this._yAxis.minimum,s.high,s.low)),this._monitorMode){const{statIndex:t,availableStats:e}=this._metadataByGroup[i];this._playDataPoint(s,t,e)}return this._shrinkToMaxWidth(),{err:null,data:s}}_initializeKeyActionMap(){this._keyEventManager=new s(this._chartElement),this._keyEventManager.registerKeyEvents([{title:"Go to next point",key:"ArrowRight",callback:this._availableActions.next_point},{title:"Go to previous point",key:"ArrowLeft",callback:this._availableActions.previous_point},{title:"Play right",key:"Shift+End",callback:this._availableActions.play_right},{title:"Play left",key:"Shift+Home",callback:this._availableActions.play_left},{title:"Cancel play",key:"Ctrl+Control",keyDescription:"Control",callback:this._availableActions.stop_play},{title:"Navigate to previous statistic",key:"ArrowUp",callback:this._availableActions.previous_stat},{title:"Navigate to next statistic",key:"ArrowDown",callback:this._availableActions.next_stat},{title:"Go to previous category",key:"PageUp",callback:this._availableActions.previous_category},{title:"Go to next category",key:"PageDown",callback:this._availableActions.next_category},{title:"Go to first point",key:"Home",callback:this._availableActions.first_point},{title:"Go to last point",key:"End",callback:this._availableActions.last_point},{title:"Replay",key:" ",keyDescription:"Spacebar",callback:this._availableActions.replay},{title:"Select item",key:"Enter",callback:this._availableActions.select},{title:"Go backward by a tenth",key:"Ctrl+ArrowLeft",callback:this._availableActions.previous_tenth},{title:"Go forward by a tenth",key:"Ctrl+ArrowRight",callback:this._availableActions.next_tenth},{title:"Go to minimum value",key:"[",callback:this._availableActions.go_minimum},{title:"Go to maximum value",key:"]",callback:this._availableActions.go_maximum},{title:"Speed up",key:"q",callback:this._availableActions.speed_up},{title:"Slow down",key:"e",callback:this._availableActions.slow_down},{title:"Toggle monitor mode",key:"m",callback:this._availableActions.monitor},{title:"Open help dialog",key:"h",callback:this._availableActions.help},{title:"Open options dialog",key:"o",callback:this._availableActions.options}]);const t=t=>{t({slice:this._groups[this._groupIndex],index:this._pointIndex})};this._options.customHotkeys?.forEach((e=>{this._keyEventManager.registerKeyEvent({...e,key:n(e.key),callback:()=>{t(e.callback)}})}))}_setHertzClamps(t,e){this._hertzClamps.lower=t,this._hertzClamps.upper=e}_initializeData(t){if(!Array.isArray(t))return this._groups=Object.keys(t),void(this._data=Object.values(t).map((t=>f(t))));this._groups=[""],this._data=[f(t)]}_startListening(){this._chartElement.addEventListener("focus",(()=>{if(this._sr.clear(),this._options.live&&this._generateSummary(),this._options.enableSpeech&&this._sr.render(this._summary),window.__chart2music_options__?._hertzClamps){const{lower:t,upper:e}=window.__chart2music_options__._hertzClamps;this._setHertzClamps(t,e)}})),this._chartElement.addEventListener("blur",(()=>{this._monitorMode=!1}))}_playAndSpeak(){this._playCurrent(),setTimeout((()=>{this._speakCurrent()}),250)}_moveRight(){const t=this._data[this._groupIndex].length-1;return this._pointIndex>=t?(this._pointIndex=t,!1):(this._pointIndex++,!0)}_moveLeft(){return this._pointIndex<=0?(this._pointIndex=0,!1):(this._pointIndex--,!0)}_moveToMinimum(){const t=this._metadataByGroup[this._groupIndex].minimumPointIndex;return-1!==t&&(this._pointIndex=t,!0)}_moveToMaximum(){const t=this._metadataByGroup[this._groupIndex].maximumPointIndex;return-1!==t&&(this._pointIndex=t,!0)}_moveLeftTenths(){return 0!==this._pointIndex&&(this._pointIndex=Math.max(this._pointIndex-this._metadataByGroup[this._groupIndex].tenths,0),!0)}_moveRightTenths(){return this._pointIndex!==this._data[this._groupIndex].length-1&&(this._pointIndex=Math.min(this._pointIndex+this._metadataByGroup[this._groupIndex].tenths,this._data[this._groupIndex].length-1),!0)}_movePrevStat(){const{statIndex:t}=this._metadataByGroup[this._groupIndex];return!(t<0)&&(this._metadataByGroup[this._groupIndex].statIndex=t-1,!0)}_moveNextStat(){const{statIndex:t,availableStats:e}=this._metadataByGroup[this._groupIndex];return!(t>=e.length-1)&&(this._metadataByGroup[this._groupIndex].statIndex=t+1,!0)}_playLeft(){this._playListInterval=setInterval((()=>{this._pointIndex<=0?(this._pointIndex=0,clearInterval(this._playListInterval)):(this._pointIndex--,this._playCurrent())}),i[this._speedRateIndex]),this._playCurrent()}_playRight(){const t=this._data[this._groupIndex].length-1;this._playListInterval=setInterval((()=>{this._pointIndex>=t?(this._pointIndex=t,clearInterval(this._playListInterval)):(this._pointIndex++,this._playCurrent())}),i[this._speedRateIndex]),this._playCurrent()}_getHertzRange(){return e.slice(this._hertzClamps.lower,this._hertzClamps.upper)}_playCurrent(){if(!this._options.enableSound)return void this._onFocus();const{statIndex:t,availableStats:e}=this._metadataByGroup[this._groupIndex],i=this._data[this._groupIndex][this._pointIndex];this._playDataPoint(i,t,e),this._onFocus()}_checkAudioEngine(){M||(M=new AudioContext),!this._audioEngine&&M&&(this._audioEngine=this._providedAudioEngine??new t(M))}_playDataPoint(t,e,n){if(this._checkAudioEngine(),!this._audioEngine)return;if(b(t.x,this._xAxis))return;const s=this._getHertzRange(),r=.98*(2*((t.x-this._xAxis.minimum)/(this._xAxis.maximum-this._xAxis.minimum))-1);if(l(t)){if(b(t.y,this._yAxis))return;const e=p(t.y,this._yAxis.minimum,this._yAxis.maximum,s.length-1,this._yAxis.type);this._audioEngine.playDataPoint(s[e],r,a)}else if(h(t)){if(b(t.y2,this._y2Axis))return;const e=p(t.y2,this._y2Axis.minimum,this._y2Axis.maximum,s.length-1,this._y2Axis.type);this._audioEngine.playDataPoint(s[e],r,a)}else if(u(t)||_(t)){if(e>=0){const i=n[e];if(b(t[i],this._yAxis))return;const o=p(t[i],this._yAxis.minimum,this._yAxis.maximum,s.length-1,this._yAxis.type);return void this._audioEngine.playDataPoint(s[o],r,a)}const o=1/(n.length+1);n.forEach(((e,n)=>{if(b(t[e],this._yAxis))return;const l=p(t[e],this._yAxis.minimum,this._yAxis.maximum,s.length-1,this._yAxis.type);setTimeout((()=>{this._audioEngine.playDataPoint(s[l],r,a)}),i[this._speedRateIndex]*o*n)}))}}_onFocus(){this._options?.onFocusCallback?.({slice:this._groups[this._groupIndex],index:this._pointIndex})}_speakCurrent(){if(!this._options.enableSpeech)return;this._flagNewGroup&&""===this._groups[this._groupIndex]&&(this._flagNewGroup=!1);const{statIndex:t,availableStats:e}=this._metadataByGroup[this._groupIndex];this._flagNewStat&&0===e.length&&(this._flagNewStat=!1);const i=this._data[this._groupIndex][this._pointIndex],a=((t,e,i,a)=>u(t)?void 0!==a?`${e(t.x)}, ${i(t[a])}`:`${e(t.x)}, ${i(t.open)} - ${i(t.high)} - ${i(t.low)} - ${i(t.close)}`:_(t)?void 0!==a?`${e(t.x)}, ${i(t[a])}`:`${e(t.x)}, ${i(t.high)} - ${i(t.low)}`:l(t)?`${e(t.x)}, ${i(t.y)}`:h(t)?`${e(t.x)}, ${i(t.y2)}`:"")(i,A(this._xAxis),A(h(i)?this._y2Axis:this._yAxis),e[t]),n=(this._flagNewGroup?`${this._groups[this._groupIndex]}, `:"")+(this._flagNewStat?`${(s=e[t]??"all").substring(0,1).toUpperCase()}${s.substring(1).toLowerCase()}`+", ":"")+a;var s;this._sr.render(n),this._flagNewGroup=!1,this._flagNewStat=!1}}return t=>{const e=(t=>{const e=[];return e.push(k(t.type)),e.push(w(t.element)),e.push(S(t.axes)),e.push(T(t.data)),e.filter((t=>""!==t)).join("\n")})(t);return""!==e?{err:e}:{err:null,data:new O(t)}}}();
//# sourceMappingURL=/sm/4b2927820366fd6ee0f7ef5a0be2e1fd74c97ecf9b33de4a03f6f6dbab75968b.map